<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Matt — Battery & Electrode Job Tracker</title>
  <style>
    :root{--bg:#0b0c0e;--card:#121317;--muted:#9aa0aa;--text:#e8eaed;--accent:#6ee7b7;--line:#23252b}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:15px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;-webkit-text-size-adjust:100%}
    a{color:inherit}
    .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
    .row{display:grid;gap:12px}
    .row.cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}
    .row.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    @media (max-width:900px){.row.cols-3,.row.cols-2{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;box-shadow:0 4px 24px rgba(0,0,0,.25);overflow:hidden}
    .card h2{margin:0 0 6px 0;font-size:16px}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--line)}
    .card .bd{padding:16px}
    .pill{display:inline-flex;gap:8px;align-items:center;padding:6px 12px;border-radius:999px;background:#171922;border:1px solid var(--line);color:var(--muted)}
    input,select,button{height:44px;background:#0f1116;border:1px solid var(--line);color:var(--text);border-radius:10px;padding:0 12px;width:100%}
    input[type=file]{height:auto}
    button{cursor:pointer;-webkit-tap-highlight-color:transparent}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:0 14px;justify-content:center}
    .btn.ghost{background:transparent;border-color:#2a2d36}
    .stats{display:grid;grid-template-columns:repeat(6,1fr);gap:10px}
    @media (max-width:900px){.stats{grid-template-columns:repeat(2,1fr)}}
    .stat{background:#0f1116;border:1px solid var(--line);border-radius:12px;padding:10px}
    .stat .k{font-size:12px;color:var(--muted)} .stat .v{font-size:18px;font-weight:600}
    .job{border-top:1px solid var(--line);padding:14px 0}
    .job:first-child{border-top:0}
    .job h3{margin:0;font-size:16px}
    .muted{color:var(--muted)}
    .badge{display:inline-block;border:1px solid var(--line);padding:4px 10px;border-radius:999px;font-size:12px;margin-left:6px;color:var(--muted)}
    .hl{display:inline-block;background:rgba(110,231,183,.12);border:1px solid rgba(110,231,183,.24);color:#b9f6de;padding:6px 12px;border-radius:999px}
    .flex{display:flex;gap:10px;flex-wrap:wrap}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap}
    @media (max-width:600px){.toolbar>button{flex:1 1 48%}}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="toolbar" style="justify-content:space-between;align-items:center;margin-bottom:14px">
      <div style="flex:1 1 auto;min-width:240px">
        <h1 style="margin:0 0 6px 0;font-size:22px">Matt — Battery & Electrode Job Tracker</h1>
        <div class="muted" style="font-size:13px">Static single‑file. Import JSON/CSV or point to a JSON endpoint. Saves locally.</div>
      </div>
      <div class="toolbar">
        <button id="btnExport" class="btn">Export JSON</button>
        <button id="btnClear" class="btn ghost">Clear</button>
      </div>
    </header><section class="card">
  <div class="hd"><h2>Filters</h2></div>
  <div class="bd row cols-3">
    <input id="q" placeholder="Search title/company/desc… (electrode, NMC, pigging)" />
    <select id="loc">
      <option value="any">Any location</option>
      <option>London</option>
      <option>Dublin</option>
      <option>Newcastle</option>
      <option>North East</option>
    </select>
    <select id="src">
      <option value="any">Any source</option>
      <option>LinkedIn</option>
      <option>Indeed</option>
      <option>WorkInBatteries</option>
    </select>
    <label class="pill" style="grid-column:1/-1"><input id="contract" type="checkbox" style="width:auto;height:auto"/> Contract / consulting only</label>
    <select id="since">
      <option value="7">Last 7 days</option>
      <option value="14">Last 14 days</option>
      <option value="30" selected>Last 30 days</option>
      <option value="90">Last 90 days</option>
      <option value="365">Last 365 days</option>
    </select>
  </div>
</section>

<section class="card" style="margin-top:12px">
  <div class="hd"><h2>Data input / sync</h2></div>
  <div class="bd row cols-2">
    <div class="flex" style="flex:1">
      <input id="endpoint" placeholder="https://raw.githubusercontent.com/USER/REPO/main/jobs.json" style="flex:1"/>
      <button id="btnFetch" class="btn" style="min-width:120px">Fetch</button>
    </div>
    <div class="flex" style="align-items:center">
      <label class="muted" style="font-size:13px">Import JSON/CSV</label>
      <input id="file" type="file" accept=".json,.csv" />
      <span class="badge">Saved locally</span>
    </div>
  </div>
</section>

<section class="row cols-2" style="margin-top:12px">
  <div class="card">
    <div class="hd"><h2>Overview</h2></div>
    <div class="bd stats" id="stats"></div>
  </div>
  <div class="card">
    <div class="hd"><h2>Highlights (last 14 days)</h2></div>
    <div class="bd" id="highlights"></div>
  </div>
</section>

<section class="card" style="margin-top:12px">
  <div class="hd"><h2>Job list</h2></div>
  <div class="bd" id="list"></div>
</section>

<footer class="muted" style="text-align:center;margin:28px 0">Built for Matt · <span id="year"></span></footer>

  </div><script>
(function(){
  const KEY_DATA = 'matt_jobs_data_v2';
  const KEY_ENDPOINT = 'matt_jobs_endpoint_v2';
  /** @type {Array<{id:string,title:string,company:string,location:string,source:string,url:string,posted:string,type?:string,description?:string}>} */
  let jobs = load(KEY_DATA) || [
    {id:'demo-1',title:'Process Engineer – Electrode (NMC)',company:'VoltCell',location:'London, UK',source:'WorkInBatteries',url:'#',posted:new Date().toISOString(),type:'Permanent',description:'Own mixing & coating process; SPC, PFMEA, yield uplift.'},
    {id:'demo-2',title:'Senior Battery Process Engineer (Consultant)',company:'AnodeLabs',location:'Dublin, IE',source:'LinkedIn',url:'#',posted:new Date(Date.now()-3*864e5).toISOString(),type:'Contract',description:'Commission slurry systems; pigging, CIP, utilities sign-off.'},
    {id:'demo-3',title:'Electrode Manufacturing Engineer',company:'NorthVolt NE',location:'Newcastle upon Tyne, UK',source:'Indeed',url:'#',posted:new Date(Date.now()-10*864e5).toISOString(),type:'Permanent',description:'Ramp-up line; OEE, SOPs, vendor FAT/SAT.'}
  ];

  const $ = sel=>document.querySelector(sel);
  const listEl = $('#list');
  const statsEl = $('#stats');
  const highlightsEl = $('#highlights');
  const qEl = $('#q');
  const locEl = $('#loc');
  const srcEl = $('#src');
  const contractEl = $('#contract');
  const sinceEl = $('#since');
  const endpointEl = $('#endpoint');
  const fileEl = $('#file');
  const yearEl = $('#year'); yearEl.textContent = new Date().getFullYear();

  endpointEl.value = load(KEY_ENDPOINT) || '';

  function save(k,v){localStorage.setItem(k,JSON.stringify(v))}
  function load(k){try{return JSON.parse(localStorage.getItem(k)||'null')}catch{return null}}
  function uniq(arr,key){const m=new Map;arr.forEach(x=>m.set(x[key],x));return [...m.values()]}

  function applyFilters(){
    const q = qEl.value.trim().toLowerCase();
    const loc = locEl.value;
    const src = srcEl.value;
    const contractOnly = contractEl.checked;
    const days = parseInt(sinceEl.value||'365',10);
    const cutoff = Date.now() - days*864e5;

    let filtered = jobs
      .filter(j => new Date(j.posted).getTime() >= cutoff)
      .filter(j => loc==='any' ? true : j.location.toLowerCase().includes(loc.toLowerCase()))
      .filter(j => src==='any' ? true : j.source===src)
      .filter(j => contractOnly ? String(j.type||'').toLowerCase().includes('contract') : true)
      .filter(j => {
        if(!q) return true; const t = (s)=>String(s||'').toLowerCase();
        return t(j.title).includes(q) || t(j.company).includes(q) || t(j.description).includes(q);
      })
      .sort((a,b)=> new Date(b.posted)-new Date(a.posted));

    renderList(filtered);
    renderStats(filtered);
    renderHighlights();
  }

  function renderList(arr){
    if(arr.length===0){listEl.innerHTML = '<div class="muted">No matches. Import or fetch to add jobs.</div>'; return}
    listEl.innerHTML = arr.map(j=>`
      <div class="job">
        <h3><a href="${j.url}" target="_blank" rel="noreferrer">${escapeHtml(j.title)}</a>
          ${j.type?`<span class="badge">${escapeHtml(j.type)}</span>`:''}
          <span class="badge">${escapeHtml(j.source)}</span>
        </h3>
        <div class="muted">${escapeHtml(j.company)} · ${escapeHtml(j.location)}</div>
        <div class="muted" style="font-size:12px">Posted ${new Date(j.posted).toLocaleDateString()}</div>
        ${j.description?`<div style="margin-top:6px">${escapeHtml(j.description)}</div>`:''}
      </div>
    `).join('');
  }

  function renderStats(filtered){
    const c = {
      total: jobs.length,
      filtered: filtered.length,
      london: jobs.filter(j=>/london/i.test(j.location)).length,
      dublin: jobs.filter(j=>/dublin/i.test(j.location)).length,
      ne: jobs.filter(j=>/newcastle|north east/i.test(j.location)).length,
      contract: jobs.filter(j=>/contract/i.test(j.type||'')).length,
    };
    statsEl.innerHTML = `
      ${stat('Total saved', c.total)}
      ${stat('Visible now', c.filtered)}
      ${stat('London', c.london)}
      ${stat('Dublin', c.dublin)}
      ${stat('North East', c.ne)}
      ${stat('Contract', c.contract)}
    `;
  }

  function stat(k,v){return `<div class="stat"><div class="k">${k}</div><div class="v">${v}</div></div>`}

  function renderHighlights(){
    const recent = jobs.filter(j=> Date.now()-new Date(j.posted).getTime() <= 14*864e5).slice(0,8);
    highlightsEl.innerHTML = recent.length ? recent.map(j=>`<span class="hl" style="margin:4px 6px 0 0">${escapeHtml(j.title)} · ${escapeHtml(j.company)}</span>`).join('') : '<span class="muted">No highlights yet.</span>';
  }

  function escapeHtml(s){return String(s).replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]))}

  // --- Mobile fix: some browsers fire 'change' (not 'input') on selects/checkboxes ---
  ;['input','change'].forEach(evt=>{
    [qEl,locEl,srcEl,contractEl,sinceEl].forEach(el=> el.addEventListener(evt, applyFilters));
  });

  $('#btnExport').addEventListener('click', ()=>{
    const blob = new Blob([JSON.stringify(jobs,null,2)],{type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = Object.assign(document.createElement('a'),{href:url,download:'jobs.json'}); a.click(); URL.revokeObjectURL(url);
  });

  $('#btnClear').addEventListener('click', ()=>{
    if(!confirm('Clear all saved jobs?')) return; jobs = []; save(KEY_DATA,jobs); applyFilters();
  });

  $('#btnFetch').addEventListener('click', async ()=>{
    const url = endpointEl.value.trim(); if(!url) return alert('Enter an endpoint URL');
    save(KEY_ENDPOINT, url);
    try{
      const res = await fetch(url,{cache:'no-store'}); if(!res.ok) throw new Error('HTTP '+res.status);
      const data = await res.json(); if(!Array.isArray(data)) throw new Error('Endpoint must return an array');
      jobs = uniq([...jobs, ...data], 'id'); save(KEY_DATA, jobs); applyFilters();
      alert('Fetched and merged '+data.length+' records.');
    }catch(e){alert('Fetch failed: '+e.message)}
  });

  fileEl.addEventListener('change', e=>{
    const f = e.target.files && e.target.files[0]; if(!f) return;
    const reader = new FileReader(); reader.onload = ()=>{
      try{
        if(f.name.endsWith('.json')){
          const data = JSON.parse(String(reader.result)); if(!Array.isArray(data)) throw new Error('JSON must be an array');
          jobs = data; save(KEY_DATA, jobs); applyFilters();
        } else {
          // CSV
          const text = String(reader.result).trim();
          const [header,...rows] = text.split(/\r?\n/).filter(Boolean);
          const cols = header.split(',').map(s=>s.trim().toLowerCase()); const idx=k=>cols.indexOf(k);
          const arr = rows.map((r,i)=>{ const p=r.split(','); return {
            id: p[idx('id')]||('csv-'+i), title: p[idx('title')]||'', company: p[idx('company')]||'',
            location: p[idx('location')]||'', source: p[idx('source')]||'CSV', url: p[idx('url')]||'',
            posted: p[idx('posted')]||new Date().toISOString(), type: p[idx('type')]||'', description: p[idx('description')]||''
          }});
          jobs = arr; save(KEY_DATA, jobs); applyFilters();
        }
      }catch(err){alert('Import failed: '+err.message)}
    }; reader.readAsText(f);
  });

  // Initial render
  applyFilters();
})();
</script></body>
</html>
